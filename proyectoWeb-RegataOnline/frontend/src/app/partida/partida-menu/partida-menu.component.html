<div class="container">
  <h1>ğŸ® MenÃº de Partida</h1>

  <div class="menu-card">
    <!-- SelecciÃ³n de Jugador (solo para administradores) -->
    @if (esAdministrador()) {
      <div class="form-group">
        <label for="jugador">Selecciona un jugador:</label>
        <select 
          id="jugador" 
          name="jugador" 
          [value]="jugadorSeleccionadoId() || ''"
          (change)="onJugadorSeleccionado($event)"
          class="select-jugador">
          <option value="" disabled selected>-- Selecciona un jugador --</option>
          @for(jugador of jugadores(); track jugador.id) {
            <option [value]="jugador.id">{{ jugador.nombre }}</option>
          }
        </select>
      </div>
    } @else if (autoSeleccionado()) {
      <!-- InformaciÃ³n del jugador auto-seleccionado -->
      <div class="jugador-info">
        <span class="icono">ğŸ‘¤</span>
        <div>
          <strong>Jugador:</strong>
          <p>Tu cuenta estÃ¡ vinculada</p>
        </div>
      </div>
    }

    @if (cargando()) {
      <div class="loading">
        <div class="spinner"></div>
        <p>Verificando partidas...</p>
      </div>
    }

    @if (jugadorSeleccionadoId() && !cargando()) {
      <div class="opciones-container">
        @if (partidaActiva()) {
          <!-- Hay partida activa -->
          <div class="partida-info">
            <div class="partida-header">
              <h2>ğŸ¯ Partida en Curso</h2>
              <span class="badge" [class.activa]="partidaActiva()!.estado === 'activa'" 
                                   [class.pausada]="partidaActiva()!.estado === 'pausada'">
                {{ partidaActiva()!.estado === 'activa' ? 'ğŸŸ¢ Activa' : 'ğŸŸ¡ Pausada' }}
              </span>
            </div>

            <div class="partida-detalles">
              <div class="detalle-item">
                <span class="icono">ğŸ—ºï¸</span>
                <div>
                  <strong>Mapa:</strong>
                  <p>{{ partidaActiva()!.mapaFilas }} x {{ partidaActiva()!.mapaColumnas }}</p>
                </div>
              </div>

              <div class="detalle-item">
                <span class="icono">ğŸš¢</span>
                <div>
                  <strong>Barco:</strong>
                  <p>{{ partidaActiva()!.barcoNombre }}</p>
                </div>
              </div>

              <div class="detalle-item">
                <span class="icono">ğŸ“</span>
                <div>
                  <strong>PosiciÃ³n:</strong>
                  <p>({{ partidaActiva()!.barcoPosicionX }}, {{ partidaActiva()!.barcoPosicionY }})</p>
                </div>
              </div>

              <div class="detalle-item">
                <span class="icono">ğŸ”¢</span>
                <div>
                  <strong>Movimientos:</strong>
                  <p>{{ partidaActiva()!.movimientos }}</p>
                </div>
              </div>
            </div>

            <div class="acciones">
              <button class="btn btn-primary" (click)="continuarPartida()">
                â–¶ï¸ Continuar Partida
              </button>
              <button class="btn btn-secondary" (click)="verDetallesPartida()">
                ğŸ“Š Ver Detalles
              </button>
              <button class="btn btn-danger" (click)="finalizarPartida()">
                ğŸ›‘ Finalizar Partida
              </button>
            </div>
          </div>
        } @else {
          <!-- No hay partida activa -->
          <div class="sin-partida">
            <div class="icon-grande">ğŸ®</div>
            <h2>No tienes partidas activas</h2>
            <p>Selecciona el modo de juego que prefieres</p>
            
            <div class="botones-modo">
              <button class="btn btn-primary btn-grande" (click)="iniciarNuevaPartida()">
                âœ¨ Iniciar Nueva Partida
                <small>Modo Un Jugador</small>
              </button>
              
              <button class="btn btn-success btn-grande" (click)="irAMultijugador()">
                ğŸ® Partida Multijugador
                <small>Hasta 4 Jugadores</small>
              </button>
            </div>
          </div>
        }
      </div>
    }

    @if (!jugadorSeleccionadoId() && !cargando()) {
      <div class="instrucciones">
        <div class="icon-grande">ğŸ‘†</div>
        <p>Selecciona un jugador para continuar</p>
      </div>
    }
  </div>
</div>
